# Структура проекта

### 1. prod
**prod** - HTTP-сервер на базе ASP.NET Core, реализующий бизнес-логику проекта. Использует ORM EF Core, тест-фреймворк xUnit, Blazor для рендеринга админ-панели и Testcontainers для интеграционных тестов. Кодовая база разбита на контроллеры и сервис-классы.
### 2. postgres
**postgres** - база данных на базе реляционной СУБД PostgreSQL. Схема базы данных доступна в DB.md. 
### 3. redis
**redis** - сервис K/V хранилища на базе Redis. Временно хранит ассоциации случайных QR-кодов и ID броней для реализации фичи сканирования кодов.

### 4. prometheus
**prometheus** - сервис для сбора метрик с бекенда на базе Prometheus.

### 5. grafana
**grafana** - сервис, предоставляющий UI для визуализации метрик на базе Grafana.

### 6. jaeger
**jaeger** - инстанс сервиса Jaeger, отслеживающий tracing-информацию с бекенда.

### 7. elasticsearch
**elasticsearch** - инстанс поисковой системы Elasticsearch, индексирующий и хранящий диагностическую информацию из **jaeger**.

### 8. loki
**loki** - сервис для сбора логов с других сервисов на базе Grafana Loki.

# Структура бекенда
Бекенд разбит на контроллеры и сервисы. Контроллеры реализуют REST-ендпоинты для общения с фронтендом и обращаются к сервисам,
где находится бизнес-логика. Стоит отметить, что админ-панель может обращаться к сервисам "напрямую" через высокоуровневый RPC-протокол на базе SignalR.

Большинство сервисов - scoped-сервисы, сопоставленные один к одному с контроллерами. Они реализуют основную часть бизнес-логики
и взаимодействуют с СУБД через сервис `ProdContext`.

Сервис `ProdContext` - связующее звено проекта на базе EF Core. Это основной сервис для общения с СУБД.

Сервис `IYandexStorageService` отвечает за взаимодействие бекенда со статическим хранилищем Яндекса.

Сервис `LateService` - рутина, выполняющаяся раз в несколько минут в такт с шагом бронирования (15 минут), которая помечает брони
как отмененные в случае опоздания или завершенные в случае истечения времени брони.

Сервис `JwtService` - Singleton-сервис, предоставляющий инструменты и данные для JWT-аутентификации.

Сервис `JwtBearerOptionsConfiguration` настраивает с помощью `JwtService` middleware аутентификации ASP.NET Core.
